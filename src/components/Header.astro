---
// src/components/Header.astro

export interface Props {
  isHomepage?: boolean;
}

const { isHomepage = false } = Astro.props;

const realizaceLink = isHomepage ? "#realizace" : "/#realizace";
const recenzeLink = isHomepage ? "#recenze" : "/#recenze";
const kontaktLink = "#kontakt"; // Kontakt je na každé stránce, takže zůstává
---

<nav class="fixed w-full z-50 top-0 transition-all duration-300 bg-brand-black md:bg-white border-b border-white/10 md:border-b-0 shadow-lg">
      
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
      
      <div class="hidden md:block absolute top-0 bottom-0 bg-brand-black z-[-1]"
           style="left: -100vw; width: calc(100vw + 320px); clip-path: polygon(0 0, calc(100% - 40px) 0, 100% 100%, 0% 100%);">
      </div>

      <div class="flex items-center justify-between h-20">
        
        <a href="/" class="flex items-end gap-5 group">
           <div class="flex gap-[5px] h-[48px] items-end"> 
              <div class="w-[13px] h-[48px] bg-white group-hover:bg-brand-accent transition-colors duration-300"></div>
              <div class="w-[13px] h-[38px] bg-white group-hover:bg-brand-accent transition-colors duration-300 delay-75"></div>
              <div class="w-[13px] h-[48px] bg-white group-hover:bg-brand-accent transition-colors duration-300 delay-150"></div>
           </div>
           <span class="font-['Montserrat'] font-black text-2xl text-white leading-none pb-1 tracking-tight">JDJ-craft</span>
        </a>

        <div class="hidden md:block">
          <div class="ml-10 flex items-baseline space-x-8 font-heading uppercase tracking-wide text-sm font-bold">
            <a href="/" class="nav-link flex items-center text-brand-black transition-colors duration-300">Domů</a>
            
            <div class="relative">
              <button id="desktop-dropdown-btn" class="nav-link flex items-center gap-1 text-brand-black transition-colors duration-300 uppercase font-heading text-sm font-bold">
                Služby
                <svg id="desktop-arrow" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3 transition-transform">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
              </button>
              
              <div id="desktop-dropdown-content" class="absolute left-0 pt-4 w-56 hidden">
                  <div class="bg-white border border-gray-100 shadow-xl rounded-sm py-2 flex flex-col">
                      <a href="/hruba-stavba" class="px-4 py-3 text-brand-black hover:bg-gray-50 hover:text-brand-accent transition-colors text-sm border-b border-gray-50 last:border-0">Hrubá stavba</a>
                      <a href="/vodo-topo" class="px-4 py-3 text-brand-black hover:bg-gray-50 hover:text-brand-accent transition-colors text-sm border-b border-gray-50 last:border-0">Vodo & Topo</a>
                      <a href="/elektroinstalace" class="px-4 py-3 text-brand-black hover:bg-gray-50 hover:text-brand-accent transition-colors text-sm border-b border-gray-50 last:border-0">Elektro</a>
                      <a href="/zednicke-prace" class="px-4 py-3 text-brand-black hover:bg-gray-50 hover:text-brand-accent transition-colors text-sm">Zednické práce</a>
                  </div>
              </div>
            </div>

            <a href={realizaceLink} class="nav-link flex items-center text-brand-black transition-colors duration-300">Realizace</a>
            <a href={recenzeLink} class="nav-link flex items-center text-brand-black transition-colors duration-300">Recenze</a>
            <a href={kontaktLink} class="flex items-center bg-brand-black text-white px-6 py-3 rounded-sm transition-all duration-300 transform hover:-translate-y-0.5 hover:bg-brand-accent shadow-lg">
              Kontakt
            </a>
          </div>
        </div>

        <div class="-mr-2 flex md:hidden">
          <button id="mobile-menu-btn" type="button" class="text-gray-400 hover:text-white p-2">
            <span class="sr-only">Otevřít menu</span>
            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
          </button>
        </div>
      </div>
    </div>

    <div id="mobile-menu" class="md:hidden bg-brand-black border-b border-white/10 max-h-0 opacity-0 overflow-hidden transition-all duration-300 ease-in-out">
      <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 font-heading uppercase">
        <a href="/" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Domů</a>
        
        <div>
            <div id="mobile-dropdown-btn" class="flex items-center justify-between text-gray-300 hover:text-white px-3 py-2 rounded-md text-base font-medium cursor-pointer">
                <span>Služby</span>
                <svg id="mobile-arrow" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 transition-transform duration-300">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
            </div>
            <div id="mobile-dropdown-content" class="pl-5 space-y-1 max-h-0 opacity-0 overflow-hidden transition-all duration-300 ease-in-out">
                <a href="/hruba-stavba" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Hrubá stavba</a>
                <a href="/vodo-topo" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Vodo & Topo</a>
                <a href="/elektroinstalace" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Elektro</a>
                <a href="/zednicke-prace" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Zednické práce</a>
            </div>
        </div>

        <a href={realizaceLink} class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Realizace</a>
        <a href={recenzeLink} class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Recenze</a>
        <a href={kontaktLink} class="text-white block px-3 py-2 rounded-md text-base font-bold bg-white/10 mt-2">Kontaktovat</a>
      </div>
    </div>
</nav>

<style>
  .nav-link {
    position: relative;
    padding-bottom: 0.5rem;
  }
  .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0.25rem;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: #0a0a0a; /* brand-black */
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.3s ease-out;
  }
  .nav-link:hover::after {
    transform: scaleX(1);
  }
  .nav-link.active::after {
    transform: scaleX(1);
  }
</style>

<script is:inline>
    // Mobile menu logic
    const btn = document.getElementById('mobile-menu-btn');
    const menu = document.getElementById('mobile-menu');

    // Mobile dropdown logic
    const dropdownBtn = document.getElementById('mobile-dropdown-btn');
    const dropdownContent = document.getElementById('mobile-dropdown-content');
    const dropdownArrow = document.getElementById('mobile-arrow');

    if (dropdownBtn && dropdownContent && dropdownArrow) {
        dropdownBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            dropdownContent.classList.toggle('max-h-96');
            dropdownContent.classList.toggle('opacity-100');
            dropdownArrow.classList.toggle('rotate-180');
        });
    }

    // Desktop dropdown logic
    const desktopDropdownBtn = document.getElementById('desktop-dropdown-btn');
    const desktopDropdownContent = document.getElementById('desktop-dropdown-content');
    const desktopArrow = document.getElementById('desktop-arrow');

    if (desktopDropdownBtn && desktopDropdownContent && desktopArrow) {
        desktopDropdownBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            desktopDropdownContent.classList.toggle('hidden');
            desktopDropdownBtn.classList.toggle('active');
            desktopArrow.classList.toggle('rotate-180');
        });

        document.addEventListener('click', (e) => {
            if (!desktopDropdownContent.contains(e.target) && e.target !== desktopDropdownBtn) {
                desktopDropdownContent.classList.add('hidden');
                desktopDropdownBtn.classList.remove('active');
                desktopArrow.classList.remove('rotate-180');
            }
        });
    }

    // General menu closing logic
    if (btn && menu) {
            const closeMenu = () => {
            menu.classList.remove('max-h-96', 'opacity-100');
            if (dropdownContent && dropdownArrow) {
                dropdownContent.classList.remove('max-h-96', 'opacity-100');
                dropdownArrow.classList.remove('rotate-180');
            }
        };
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            menu.classList.toggle('max-h-96');
            menu.classList.toggle('opacity-100');
        });

        // Close menu when clicking links (except dropdown toggle)
        menu.querySelectorAll('a').forEach(link => {
            // We check if the link is the dropdown toggle itself
            if (link.parentElement.id !== 'mobile-dropdown-btn') {
                 link.addEventListener('click', closeMenu);
            }
        });

        document.addEventListener('click', (e) => {
            if (!menu.contains(e.target) && e.target !== btn) {
                closeMenu();
            }
        });

        window.addEventListener('scroll', closeMenu);
    }
</script>